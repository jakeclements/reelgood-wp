function calendar_toggle(a){a.find(".calendar-widget-filters-title").hide();a.find(".calendar-widget-filters-operand").hide();var b=a.find(".calendar-widget-added-filters");b.length&&(b=b.val()?jQuery.parseJSON(b.val()):{},b=get_term_count(b),0<b&&(a.find(".calendar-widget-filters-title").show(),1<b&&a.find(".calendar-widget-filters-operand").show()))}function calendar_toggle_all(){jQuery(".calendar-widget-filters-container").each(function(a,b){calendar_toggle(jQuery(b))})}
function get_term_count(a){var b=0,d;for(d in a)b+=a[d].length;return b}
jQuery(document).ready(function(a){a("div.widgets-sortables").on("sortstop",function(){setTimeout(function(){a("#widgets-right select.calendar-widget-add-filter").select2();calendar_toggle_all()},600)});a("#widgets-right select.calendar-widget-add-filter").select2();a("body").on("change","select.calendar-widget-add-filter",function(b){a(".calendar-widget-filters-container").show();var d=a(this);b=a(this.options[this.selectedIndex]);var d=d.parents(".widget-content"),e=d.find(".calendar-widget-filter-list"),
c=d.find(".calendar-widget-added-filters"),f=b.attr("value"),g=b.closest("optgroup"),h=g.attr("id"),g=g.attr("label");if(0!==parseInt(f)){var k=c.val()?a.parseJSON(c.val()):{};k[h]||(k[h]=[]);-1==jQuery.inArray(f,k[h])&&(k[h].push(f),c.val(JSON.stringify(k)),c=a("<a/>").addClass("calendar-widget-remove-filter").attr("data-tax",h).attr("data-term",f).text("(remove)").attr("href","#"),c=a("<span/>").append(c),b=a("<li/>").append("p").text(g+": "+b.text()+"   ").append(c),e.append(b),calendar_toggle(d))}});
a("body").on("click",".calendar-widget-remove-filter",function(b){b.preventDefault();b=a(this);var d=b.attr("data-tax"),e=b.attr("data-term"),c=b.parents(".widget-content"),f=c.find(".calendar-widget-added-filters"),g=f.val()?a.parseJSON(f.val()):{};g[d]&&g[d].myremove(e);f.val(JSON.stringify(g));b.parents("li").remove();calendar_toggle(c)});Array.prototype.myremove=function(){for(var b,a=arguments,e=a.length,c;e&&this.length;)for(b=a[--e];-1!=(c=this.indexOf(b));)this.splice(c,1);return this};Array.prototype.indexOf||
(Array.prototype.indexOf=function(b,a){a=a||0;for(var e=this.length;a<e;){if(this[a]===b)return a;++a}return-1})});
